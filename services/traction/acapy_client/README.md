# openapi-client
No description provided (generated by Openapi Generator https://github.com/openapitools/openapi-generator)

This Python package is automatically generated by the [OpenAPI Generator](https://openapi-generator.tech) project:

- API version: v0.7.2
- Package version: 1.0.0
- Build package: org.openapitools.codegen.languages.PythonClientCodegen

## Requirements.

Python >=3.6

## Generating ACA-Py client code

Some of the validation patterns in the ACA-Py swagger throw errors when generating the client code, these were deleted from the json file, and therefore these validations are missing in the client code.

For example, the UUID pattern:

```
    "pattern": "[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-4[a-fA-F0-9]{3}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}",
```

... was removed everywhere it was specified.

The generated ApiClient itself was modified to inject the tenant header into the request, when calling ACA-Py:

```
    # Aca-py customization - add required headers
    headers = get_acapy_headers(headers)
    logger.warn(f"Calling api with headers: {headers}")
```

(See [this commit](https://github.com/bcgov/traction/pull/70/commits/dadda0f6071dcfc967cf1cbfda3ae74aa3d068c1))

## Using the ACA-Py client API

The functions corresponding to each ACA-Py endpoint are [here](./api), and the model classes (API inputs and responses) are [here](./model).

To call an endpoint, you first need to create an instance of the api class, for example:

```
from api.api_client_utils import get_api_client

connection_api = ConnectionApi(api_client=get_api_client())
```

(`get_api_client` is a helper method that instantiates the api client with appropriate configuration)

TBD - we need to determine some standards around creating these api objects - should they be global per class, created per each endpoint invocation, etc?

Review the api code and import any necessary model files, for example:

```
from acapy_client.api.connection_api import ConnectionApi
from acapy_client.api.out_of_band_api import OutOfBandApi
from acapy_client.model.conn_record import ConnRecord
from acapy_client.model.connection_list import ConnectionList
```

Here is an example of calling an api:

```
        data = {
            "alias": alias,
            "handshake_protocols": [
                "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0",
            ],
        }
        inv = out_of_band_api.out_of_band_create_invitation_post(
            body=InvitationCreateRequest(**data)
        )
        connection = await get_connection_with_alias(alias)
        invitation = inv_record_to_invitation(inv, connection.connection_id)
```

Note that the response (`inv`) is an `Invitation` object.  In this example, it's converted to an object that can be returned from the Traction endpoint.

Another example (consuming the invitation) is:

```
        params = {"alias": alias, "body": InvitationMessage(**payload)}
        connection = out_of_band_api.out_of_band_receive_invitation_post(**params)
```

Note that the input needs to be converted to an `InvitationMessage` model object before callign the API.  (`payload` is the invitation contents passed to the Traction endpoint.)

## Things to consider

1. The api functions are synchronous by default.  If we call asynchronously, then the methods return a thread instead of a model object.  This breaks Traction because the request is executed on a new thread, and we lose the context of the request (i.e. the tenand id)

2. You can optionally set `_preload_content=False` (the default if not specified is `True`) - this will return the raw HTTP response, and you will need to "unwind" any response data yourself.  Here is an example:

```
    params = {
        "_preload_content": False,
    }
    if alias:
        params["alias"] = alias
    ...
 
    resp = connection_api.connections_get(**params)

    # if we set `"_preload_content": False` then we get the bare HTTP response
    # ... and we have to deserialize ourselves
    resp_text = resp.data
    result = json.loads(resp_text)
    # "result" is just a plain dict
    connections = result["results"]
```
