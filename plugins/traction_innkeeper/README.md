### developer notes

- install python 3.6.13
- install poetry version 1.1.11
- the base docker image is python 3.6.13, so best to develop using that version
- there are issues using poetry lock files generated by a newer version, then run using an older version. the dockerfile uses 1.1.11, so stick with that



### build and run
```
cd docker
docker build -f ./Dockerfile --tag traction_innkeeper ..
docker run -it -p 3000:3000 -p 3001:3001 --rm traction_innkeeper
```


### notes for proof of concept

#### traction_innkeeper plugin

- creates an innkeeper wallet and tenant on start up (if not already created)
- prints out the traction_innkeeper wallet_id/key and a token 
- will need to set up configuration to set the name, wallet_id/key so it's known and consistent

*IMPORTANT* will need the `X-API-KEY` (default = change-me) for all calls in swagger

#### demo flow

1) prospective tenant (think hitting public page, possibly with captcha)

- call `/multitenancy/reservation` to start the process (provide contact info, reason etc)
- todo: notification to innkeeper (and associated persons) that a request has come in

2) innkeeper

- call `/innkeeper/reservations` to list all reservations, fetch the above reservation_id
- call `/innkeeper/reservations/{reservation_id}/approve` to approve (probably a lot of out of band stuff)
- result of this call is a `reservation_pwd`, this needs to be delivered to the reservation's contact

3) prospective tenant (another public page, could be scanned from delivered qr code?)
- once prospective tenant has been approved and provided with the `reservation_pwd`, they call `/multitenancy/signin` with the `reservation_pwd`.
- result of `/multitenancy/signin` call is `wallet_id`, `wallet_key`, `token` -> they save this themselves


#### "public" endpoints

- `POST /multitencancy/reservation`
- `POST /multitenancy/signin`

We have to use /multitenancy because there are no ways to put in "public" endpoints in the admin server with multi-tenancy enabled.
These endpoints do not require a Bearer token, so we can call them from our app (app still needs X-API-KEY)

#### innkeeper endpoints (secured to only allow innkeeper wallet/tenant - need Bearer token)

- `GET /innkeeper/reservations`
- `PUT /innkeeper/reservations/{reservation_id}/approve`
- `GET /innkeeper/tenants`
- `GET /innkeeper/tenants/{tenant_id}`

innkeeper is a "special" tenant, use middleware to restrict these calls.

#### tenant endpoints (secured to any wallet/tenant - need Bearer token)
- `GET /tenant` (basically get self)

Tenants do not need to know their tenant id, we grab their wallet_id from their token and look up using that.

Still lots to flesh out, this was just proof of concept to see about data storage, flow, etc.  
