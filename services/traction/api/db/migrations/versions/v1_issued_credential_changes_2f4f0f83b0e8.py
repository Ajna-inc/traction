"""v1-issued_credential_changes

Revision ID: 2f4f0f83b0e8
Revises: c9b007919a5d
Create Date: 2022-05-23 16:52:07.565260

"""
from alembic import op
import sqlalchemy as sa
import sqlmodel
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = "2f4f0f83b0e8"
down_revision = "c9b007919a5d"
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(
        "ix_connection_invitation_invitation_key", table_name="connection_invitation"
    )
    op.add_column(
        "issued_credential",
        sa.Column("contact_id", sqlmodel.sql.sqltypes.GUID(), nullable=False),
    )
    op.add_column(
        "issued_credential",
        sa.Column("credential_persisted", sa.Boolean(), nullable=False),
    )
    op.add_column(
        "issued_credential",
        sa.Column("comment", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
    )
    op.add_column(
        "issued_credential",
        sa.Column(
            "credential_exchange_id", sqlmodel.sql.sqltypes.AutoString(), nullable=True
        ),
    )
    op.add_column(
        "issued_credential",
        sa.Column("revoc_reg_id", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
    )
    op.add_column(
        "issued_credential",
        sa.Column("revocation_id", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
    )
    op.create_index(
        op.f("ix_issued_credential_contact_id"),
        "issued_credential",
        ["contact_id"],
        unique=False,
    )
    op.create_foreign_key(
        None, "issued_credential", "contact", ["contact_id"], ["contact_id"]
    )
    op.drop_column("issued_credential", "cred_rev_id")
    op.drop_column("issued_credential", "credential_exchange")
    op.drop_column("issued_credential", "rev_reg_id")
    op.create_index(op.f("ix_tenant_name"), "tenant", ["name"], unique=False)
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f("ix_tenant_name"), table_name="tenant")
    op.add_column(
        "issued_credential",
        sa.Column("rev_reg_id", sa.VARCHAR(), autoincrement=False, nullable=True),
    )
    op.add_column(
        "issued_credential",
        sa.Column(
            "credential_exchange",
            postgresql.JSON(astext_type=sa.Text()),
            autoincrement=False,
            nullable=True,
        ),
    )
    op.add_column(
        "issued_credential",
        sa.Column("cred_rev_id", sa.VARCHAR(), autoincrement=False, nullable=True),
    )
    op.drop_constraint(None, "issued_credential", type_="foreignkey")
    op.drop_index(
        op.f("ix_issued_credential_contact_id"), table_name="issued_credential"
    )
    op.drop_column("issued_credential", "revocation_id")
    op.drop_column("issued_credential", "revoc_reg_id")
    op.drop_column("issued_credential", "credential_exchange_id")
    op.drop_column("issued_credential", "comment")
    op.drop_column("issued_credential", "credential_persisted")
    op.drop_column("issued_credential", "contact_id")
    op.create_index(
        "ix_connection_invitation_invitation_key",
        "connection_invitation",
        ["invitation_key"],
        unique=False,
    )
    # ### end Alembic commands ###
